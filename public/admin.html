<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link rel="icon" type="image/jpeg" href="assets/images/CloakHood.jpg" />
    <link rel="stylesheet" href="colors.css" />
    <link rel="stylesheet" href="ui.css" />
    <style>
      :root {
        --deep-green: var(--CG-deep-green);
        --deep-purple: var(--CG-deep-purple);
        --deep-gold: var(--CG-deep-gold);
        --light-gold: var(--CG-light-gold);
      }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 0; background-color: var(--deep-green); color: var(--light-gold); position: relative; }
      body::before { content: ""; position: fixed; inset: 0; background: url('assets/images/Background.png') center/cover no-repeat; filter: brightness(0.8) contrast(0.65); z-index: -1; }
      .container { padding: 24px; max-width: 1100px; margin: 0 auto; box-sizing: border-box; }
      h2 { margin: 0 0 16px; font-weight: 700; color: var(--light-gold); }
      .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
      .card { border: 4px solid var(--deep-gold); border-radius: 6px; padding: 16px; background: var(--deep-purple); }
      .label { color: var(--light-gold); font-size: 14px; }
      .value { font-size: 28px; font-weight: 700; color: var(--light-gold); }
      .listCard { border: 4px solid var(--deep-gold); border-radius: 6px; padding: 12px; background: var(--deep-purple); }
      .listCard .title { color: var(--light-gold); font-size: 14px; margin: 0 0 8px; font-weight: 700; }
      .tableList { height: 200px; overflow: auto; border: 1px solid rgba(184,134,11,0.55); border-radius: 4px; background: transparent; }
      .tableList .row { padding: 6px 10px; border-bottom: 1px solid rgba(184,134,11,0.35); color: var(--light-gold); font-size: 13px; line-height: 1.3; word-break: break-all; display: flex; align-items: center; gap: 8px; }
      .tableList .row:last-child { border-bottom: 0; }
      .tableList .headerRow { font-weight: 700; justify-content: space-between; gap: 0; }
      .tableList .userActionCell { display: inline-flex; justify-content: center; align-items: center; gap: 4px; white-space: nowrap; }
      .user-delete-btn { border: none; background: transparent; color: rgba(255,215,0,0.85); cursor: pointer; display: inline-flex; align-items: center; justify-content: center; padding: 6px; border-radius: 6px; font-size: 18px; line-height: 1; transition: transform 0.15s ease, color 0.2s ease, background 0.2s ease; }
      .user-delete-btn:hover { color: var(--deep-green); background: var(--light-gold); transform: scale(1.08); }
      .user-delete-btn:focus-visible { outline: 2px solid var(--light-gold); outline-offset: 2px; }
      .user-delete-btn[disabled] { opacity: 0.45; cursor: not-allowed; }
      .tableList .matchTypePill { display: inline-flex; align-items: center; justify-content: center; padding: 2px 8px; border-radius: 999px; border: 1px solid rgba(255,215,0,0.55); background: rgba(255,215,0,0.12); font-size: 10px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; white-space: nowrap; }
      .tableList .matchId { font-size: 11px; opacity: 0.8; word-break: break-all; }
      .tableList .matchScoreLine {
        display: inline-flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 8px;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
      }
      .tableList .matchPlayerName { font-weight: 600; }
      .tableList .matchScoreValue {
        color: #34d399;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
      }
      .tableList .matchScoreSeparator { opacity: 0.8; }
      .tableList .matchDrawLine {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        opacity: 0.85;
      }
      .tableList .matchDrawIcon {
        width: 18px;
        height: 18px;
        object-fit: contain;
        filter: drop-shadow(0 0 4px rgba(0,0,0,0.35));
      }
      .tableList .spectateBtn { margin-left: auto; border: 2px solid var(--deep-gold); background: var(--light-gold); color: var(--deep-green); padding: 6px 12px; border-radius: 6px; font-weight: 700; cursor: pointer; transition: transform 0.15s ease, background 0.2s ease; }
      .tableList .spectateBtn:hover { background: #ffe69c; transform: translateY(-1px); }
      .tableList .spectateBtn:active { transform: translateY(0); }

      .tab-header { display: flex; gap: 12px; margin-bottom: 16px; border-bottom: 3px solid rgba(184,134,11,0.45); }
      .tab-button { background: none; border: none; color: rgba(255,215,0,0.65); font-size: 22px; font-weight: 700; padding: 12px 16px; cursor: pointer; position: relative; transition: color 0.2s ease; }
      .tab-button::after { content: ""; position: absolute; left: 0; right: 0; bottom: -3px; height: 3px; background: transparent; transition: background 0.2s ease; }
      .tab-button.active { color: var(--light-gold); }
      .tab-button.active::after { background: var(--deep-gold); }
      .tab-panel { display: none; }
      .tab-panel.active { display: block; }

      .history-summary { display: grid; gap: 10px; grid-template-columns: repeat(2, minmax(0, 1fr)); margin-bottom: 12px; }
      .history-card { border: 3px solid var(--deep-gold); border-radius: 8px; padding: 10px; background: rgba(38,17,58,0.72); display: grid; gap: 6px; align-content: start; justify-items: center; text-align: center; min-width: 0; }
      .history-card .history-card-label { font-size: 12px; text-transform: uppercase; letter-spacing: 0.08em; color: rgba(245,230,167,0.88); }
      .history-card .history-card-stats { display: flex; flex-direction: column; align-items: center; gap: 4px; min-width: 0; }
      .history-card .history-card-total { font-size: 24px; font-weight: 700; color: var(--light-gold); line-height: 1.1; }
      .history-card .history-card-splits {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.02em;
        font-family: 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        font-variant-numeric: lining-nums tabular-nums;
        font-feature-settings: 'lnum' 1, 'tnum' 1;
      }
      .history-card .history-card-split { display: inline-flex; align-items: baseline; gap: 3px; }
      .history-card .history-card-split--wins { color: #34d399; }
      .history-card .history-card-split--draws { color: #9ca3af; }
      .history-card .history-card-split--losses { color: #f87171; }

      .history-filters { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
      .history-filter-btn { border: 2px solid var(--deep-gold); background: rgba(38,17,58,0.6); color: var(--light-gold); padding: 8px 14px; border-radius: 999px; cursor: pointer; font-weight: 600; transition: background 0.2s ease, transform 0.15s ease; }
      .history-filter-btn:hover { background: rgba(184,134,11,0.25); }
      .history-filter-btn.active { background: var(--deep-gold); color: var(--deep-green); }

      .history-matches { display: flex; flex-direction: column; gap: 12px; }
      .history-row { border: 4px solid var(--deep-gold); border-radius: 8px; background: rgba(24,9,38,0.85); padding: 16px; display: flex; flex-direction: column; gap: 12px; }
      .history-row-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; flex-wrap: nowrap; }
      .history-row-header { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 0; }
      .history-pill { padding: 4px 10px; border-radius: 999px; border: 1px solid rgba(255,215,0,0.6); background: rgba(255,215,0,0.15); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; }
      .history-date { font-size: 12px; color: rgba(255,215,0,0.75); }
      .history-delete-btn { border: none; background: transparent; color: rgba(255,215,0,0.85); cursor: pointer; display: inline-flex; align-items: center; justify-content: center; padding: 6px; border-radius: 6px; font-size: 18px; line-height: 1; transition: transform 0.15s ease, color 0.2s ease, background 0.2s ease; }
      .history-delete-btn:hover { color: var(--deep-green); background: var(--light-gold); transform: scale(1.08); }
      .history-delete-btn:focus-visible { outline: 2px solid var(--light-gold); outline-offset: 2px; }
      .history-delete-btn[disabled] { opacity: 0.45; cursor: not-allowed; }
      .admin-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; padding: 16px; z-index: 1000; }
      .admin-modal-overlay[hidden] { display: none; }
      .admin-modal { background: rgba(24,9,38,0.95); border: 4px solid var(--deep-gold); border-radius: 8px; padding: 20px; width: 100%; max-width: 360px; box-sizing: border-box; color: var(--light-gold); display: flex; flex-direction: column; gap: 16px; }
      .admin-modal-title { margin: 0; font-size: 20px; font-weight: 700; color: var(--light-gold); }
      .admin-modal-message { margin: 0; font-size: 14px; line-height: 1.5; color: rgba(255,215,0,0.9); }
      .admin-modal-actions { display: flex; justify-content: flex-end; gap: 12px; flex-wrap: wrap; }
      .admin-modal-button { cursor: pointer; border: 2px solid var(--deep-gold); border-radius: 6px; font-weight: 700; padding: 8px 14px; background: rgba(24,9,38,0.6); color: var(--light-gold); transition: background 0.2s ease, color 0.2s ease, transform 0.15s ease; }
      .admin-modal-button:hover { background: rgba(184,134,11,0.25); }
      .admin-modal-button:focus-visible { outline: 2px solid var(--light-gold); outline-offset: 2px; }
      .admin-modal-button--danger { background: var(--light-gold); color: var(--deep-green); }
      .admin-modal-button--danger:hover { background: #ffe69c; }
      .history-player-name { font-weight: 700; min-width: 0; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .history-player-score { font-size: 18px; font-weight: 700; font-variant-numeric: tabular-nums; }
      .history-player-elo { font-size: 12px; color: rgba(255,215,0,0.75); }
      .history-match-table { display: flex; flex-direction: column; gap: 12px; }
      .history-match-row { display: grid; grid-template-columns: minmax(0, 280px) 1fr; gap: 16px; align-items: center; }
      .history-match-player-info { display: flex; align-items: center; gap: 12px; min-width: 0; }
      .history-match-player-details { display: flex; flex-direction: column; gap: 4px; min-width: 0; flex: 1; }
      .history-player-label-row { display: flex; align-items: baseline; gap: 8px; }
      .history-match-games {
        --history-match-game-count: 1;
        --history-match-max-game-count: var(--history-match-game-count);
        --history-match-square-base: 34px;
        --history-match-square-min: 18px;
        --history-match-gap: 8px;
        --history-match-square-size: clamp(
          var(--history-match-square-min),
          calc((100% - (var(--history-match-max-game-count) - 1) * var(--history-match-gap)) / var(--history-match-max-game-count)),
          var(--history-match-square-base)
        );
        display: flex;
        gap: var(--history-match-gap);
        align-items: center;
        width: 100%;
        max-width: 100%;
        padding-bottom: 4px;
        overflow: hidden;
      }
      .history-match-square {
        width: var(--history-match-square-size);
        height: var(--history-match-square-size);
        border: 3px solid var(--deep-gold);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0,0,0,0.25);
        position: relative;
        flex: 0 1 var(--history-match-square-size);
        min-width: var(--history-match-square-min);
        max-width: var(--history-match-square-base);
      }
      .history-match-square .history-status-icon { max-width: 70%; max-height: 70%; }
      .history-match-square.color-white { background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6)); }
      .history-match-square.color-black { background: linear-gradient(135deg, rgba(10,10,10,0.9), rgba(40,40,40,0.9)); }
      .history-match-square.color-unknown { background: rgba(0,0,0,0.35); }
      .history-match-square img { width: 24px; height: 24px; object-fit: contain; }
      .history-status-icon { pointer-events: none; }
      .history-match-empty { font-size: 13px; color: rgba(255,215,0,0.75); white-space: nowrap; }

      @media (max-width: 720px) {
        .tab-header { flex-wrap: wrap; }
        .history-match-row { grid-template-columns: minmax(0, 1fr); }
        .history-match-games { --history-match-gap: 6px; }
        .history-row-top { flex-wrap: wrap; }
        .history-delete-btn { order: 3; }
      }

      @media (min-width: 768px) {
        .history-summary { grid-template-columns: repeat(4, minmax(0, 1fr)); }
      }

      @media (max-width: 640px) {
        .history-card { padding: 9px; }
        .history-card .history-card-label { font-size: 11px; }
        .history-card .history-card-total { font-size: 22px; }
        .history-card .history-card-splits { gap: 8px; font-size: 11px; }
      }

      @media (max-width: 420px) {
        .history-card { padding: 8px; }
        .history-card .history-card-total { font-size: 20px; }
        .history-card .history-card-splits { gap: 6px; font-size: 10px; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 style="margin: 0 0 16px; font-size: 32px; font-weight: 800; color: var(--light-gold);">Admin Dashboard</h1>
      <div class="tab-header">
        <button class="tab-button active" data-tab="live">Live</button>
        <button class="tab-button" data-tab="history">History</button>
      </div>

      <div id="adminLivePanel" class="tab-panel active" data-tab-panel="live">
        <h2>Live</h2>
        <div class="grid">
          <div class="card"><div class="label">Connected Users</div><div id="connectedUsers" class="value">0</div></div>
          <div class="card"><div class="label">Quickplay Queue</div><div id="quickplayQueue" class="value">0</div></div>
          <div class="card"><div class="label">Ranked Queue</div><div id="rankedQueue" class="value">0</div></div>
        </div>

        <div class="grid" style="margin-top: 12px;">
          <div class="listCard">
            <div class="title">Quickplay Queue</div>
            <div id="quickplayQueueList" class="tableList" role="table"></div>
          </div>
          <div class="listCard">
            <div class="title">Ranked Queue</div>
            <div id="rankedQueueList" class="tableList" role="table"></div>
          </div>
          <div class="listCard" style="grid-column: span 2;">
            <div class="title">Users</div>
            <div id="usersList" class="tableList" role="table"></div>
          </div>
        </div>

        <div style="margin-top: 16px; display: flex; gap: 12px; flex-wrap: wrap;">
          <button id="purgeActiveMatchesBtn" style="cursor:pointer; padding: 10px 14px; font-weight: 800; color: var(--deep-green); background: var(--light-gold); border: 3px solid var(--deep-gold); border-radius: 6px;">Purge Active Matches</button>
          <span style="opacity:0.85; font-size:12px; align-self:center;">Requires server `ADMIN_SECRET` header to authorize.</span>
        </div>

        <div class="grid" style="margin-top: 12px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));">
          <div class="listCard" style="grid-column: span 2;">
            <div class="title">Active Matches</div>
            <div id="matchesList" class="tableList" role="table"></div>
          </div>
        </div>
      </div>

      <div id="adminHistoryPanel" class="tab-panel" data-tab-panel="history">
        <h2>History</h2>
        <div class="history-summary">
          <div class="history-card">
            <div class="history-card-label">
              <span class="history-card-label-line">Total</span>
              <span class="history-card-label-line">Games</span>
            </div>
            <div class="history-card-stats">
              <span id="historyTotalGames" class="history-card-total history-card-value">0</span>
              <div class="history-card-splits">
                <span class="history-card-split history-card-split--wins">W:<span id="historyTotalGamesWins">0</span></span>
                <span class="history-card-split history-card-split--draws">D:<span id="historyTotalGamesDraws">0</span></span>
                <span class="history-card-split history-card-split--losses">L:<span id="historyTotalGamesLosses">0</span></span>
              </div>
            </div>
          </div>
          <div class="history-card">
            <div class="history-card-label">
              <span class="history-card-label-line">Quickplay</span>
              <span class="history-card-label-line">Matches</span>
            </div>
            <div class="history-card-stats">
              <span id="historyQuickplayMatches" class="history-card-total history-card-value">0</span>
              <div class="history-card-splits">
                <span class="history-card-split history-card-split--wins">W:<span id="historyQuickplayWins">0</span></span>
                <span class="history-card-split history-card-split--draws">D:<span id="historyQuickplayDraws">0</span></span>
                <span class="history-card-split history-card-split--losses">L:<span id="historyQuickplayLosses">0</span></span>
              </div>
            </div>
          </div>
          <div class="history-card">
            <div class="history-card-label">
              <span class="history-card-label-line">Ranked</span>
              <span class="history-card-label-line">Matches</span>
            </div>
            <div class="history-card-stats">
              <span id="historyRankedMatches" class="history-card-total history-card-value">0</span>
              <div class="history-card-splits">
                <span class="history-card-split history-card-split--wins">W:<span id="historyRankedWins">0</span></span>
                <span class="history-card-split history-card-split--draws">D:<span id="historyRankedDraws">0</span></span>
                <span class="history-card-split history-card-split--losses">L:<span id="historyRankedLosses">0</span></span>
              </div>
            </div>
          </div>
          <div class="history-card">
            <div class="history-card-label">
              <span class="history-card-label-line">Custom</span>
              <span class="history-card-label-line">Matches</span>
            </div>
            <div class="history-card-stats">
              <span id="historyCustomMatches" class="history-card-total history-card-value">0</span>
              <div class="history-card-splits">
                <span class="history-card-split history-card-split--wins">W:<span id="historyCustomWins">0</span></span>
                <span class="history-card-split history-card-split--draws">D:<span id="historyCustomDraws">0</span></span>
                <span class="history-card-split history-card-split--losses">L:<span id="historyCustomLosses">0</span></span>
              </div>
            </div>
          </div>
        </div>

        <div class="history-filters">
          <button class="history-filter-btn active" data-history-filter="all">All</button>
          <button class="history-filter-btn" data-history-filter="quickplay">Quickplay</button>
          <button class="history-filter-btn" data-history-filter="custom">Custom</button>
          <button class="history-filter-btn" data-history-filter="ranked">Ranked</button>
        </div>

        <div id="historyMatchesList" class="history-matches" aria-live="polite"></div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="/admin.js"></script>
  </body>
  </html>


